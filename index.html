<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitTree - GitHub Repo Tree Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root{--font-sans:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;--font-mono:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;--bg-color:#f3f3f8;--body-bg:#fff;--text-primary:#1d1d1f;--text-secondary:#6e6e73;--border-color:#d2d2d7;--primary-color:#007aff;--primary-hover:#0071e3;--control-bg:#f0f0f0;--control-bg-hover:#e0e0e0;--shadow-color:rgba(0,0,0,.05);--danger-color:#d73a49}html[data-theme=dark]{--bg-color:#1c1c1e;--body-bg:#2c2c2e;--text-primary:#f5f5f7;--text-secondary:#8e8e93;--border-color:#444446;--primary-color:#0a84ff;--primary-hover:#0a84ff;--control-bg:#3a3a3c;--control-bg-hover:#545456;--shadow-color:rgba(0,0,0,.2);--danger-color:#ff453a}body{font-family:var(--font-sans);background-color:var(--bg-color);color:var(--text-primary);margin:0;padding:2rem;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;transition:background-color .3s ease,color .3s ease;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.container{box-sizing:border-box;position:relative;width:100%;max-width:800px;background-color:var(--body-bg);border:1px solid var(--border-color);border-radius:18px;box-shadow:0 12px 40px var(--shadow-color);padding:2rem 2.5rem 2.5rem;transition:background-color .3s ease,border-color .3s ease}#app-controls{position:absolute;top:1rem;right:1rem;display:flex;gap:.5rem;align-items:center}#theme-toggle,#lang-toggle{background:0 0;border:none;cursor:pointer;padding:5px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--text-secondary)}#lang-toggle{font-family:var(--font-sans);font-size:1rem;font-weight:600;padding:5px 8px;width:auto;min-width:40px;text-align:center}#theme-toggle:hover,#lang-toggle:hover{color:var(--text-primary);background-color:var(--control-bg)}#theme-toggle svg{width:22px;height:22px}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}h1{text-align:center;font-size:2rem;font-weight:600;margin-top:0;margin-bottom:.5rem}.subtitle{text-align:center;font-size:1rem;color:var(--text-secondary);margin-bottom:2rem}pre#result{font-family:var(--font-mono);font-size:.9rem;color:var(--text-primary);white-space:pre;padding:1.5rem;margin:0;max-height:50vh;overflow:auto;line-height:1.6;background-color:var(--body-bg);transition:background-color .3s ease,color .3s ease}pre#result.error{color:var(--danger-color);font-family:var(--font-sans);white-space:normal}.input-wrapper{display:flex;gap:1rem;margin-bottom:1rem}input[type=text],input[type=number]{padding:.8rem 1rem;font-size:1rem;border:1px solid var(--border-color);border-radius:10px;font-family:var(--font-sans);background-color:var(--body-bg);color:var(--text-primary);transition:border-color .2s,box-shadow .2s,background-color .3s ease}input[type=text]{flex-grow:1}input[type=text]:focus,input[type=number]:focus{border-color:var(--primary-color);box-shadow:0 0 0 4px var(--primary-color)33;outline:0}button#generateBtn{padding:.8rem 1.5rem;font-size:1rem;font-weight:600;color:#fff;background-color:var(--primary-color);border:none;border-radius:10px;cursor:pointer;transition:background-color .2s,transform .1s;display:flex;align-items:center;justify-content:center;white-space:nowrap}button#generateBtn:hover{background-color:var(--primary-hover)}button#generateBtn:active{transform:scale(.98)}button#generateBtn:disabled{background-color:#a0a0a0;cursor:not-allowed;opacity:.8}.spinner{border:2px solid #fff3;border-radius:50%;border-top-color:#fff;width:16px;height:16px;animation:spin 1s linear infinite;margin-right:.5rem}.advanced-options{margin-top:1rem}.advanced-options summary{cursor:pointer;color:var(--text-secondary);font-size:.9rem;font-weight:500;list-style-position:expert;display:inline-block;padding:.25rem .5rem;border-radius:6px}.advanced-options summary:hover{background-color:var(--control-bg)}.advanced-options-grid{display:grid;grid-template-columns:1fr auto;gap:1rem;margin-top:.75rem;align-items:center}.advanced-options label{color:var(--text-secondary);font-size:.9rem}input#depthInput{width:70px;text-align:center}input#excludeInput{width:100%;box-sizing:border-box}.result-wrapper{margin-top:2rem;border:1px solid var(--border-color);border-radius:12px;overflow:hidden;transition:border-color .3s ease}.result-header{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background-color:var(--control-bg);border-bottom:1px solid var(--border-color);transition:background-color .3s ease,border-color .3s ease}.header-group{display:flex;align-items:center;gap:.5rem}.header-group button{background:0 0;border:none;padding:.3rem .5rem;cursor:pointer;color:var(--text-secondary);font-family:var(--font-sans);font-size:.8rem;display:flex;align-items:center;gap:.3rem;border-radius:6px;transition:background-color .2s,color .2s}.header-group button:hover{background-color:var(--control-bg-hover);color:var(--text-primary)}.header-group button svg{width:18px;height:18px;stroke-width:1.8}.view-modes button.active{color:var(--primary-color);background-color:var(--primary-color)26}.header-group button:disabled{opacity:.5;cursor:not-allowed}#copyBtn .copy-icon{width:1em;height:1em;stroke-width:2;vertical-align:middle}#image-card-container{position:absolute;left:-9999px;top:-9999px;padding:4rem;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}.macos-window{width:800px;background-color:#2e2e2e;border-radius:10px;box-shadow:0 25px 50px -12px rgba(0,0,0,.4);padding-bottom:20px;border:1px solid #444}.title-bar{height:48px;display:flex;align-items:center;justify-content:center;position:relative;padding:0 15px;border-bottom:1px solid #404040}.traffic-lights{position:absolute;left:15px;display:flex;gap:8px}.light{width:12px;height:12px;border-radius:50%}.light.red{background-color:#ff5f56}.light.yellow{background-color:#ffbd2e}.light.green{background-color:#27c93f}.title-text{color:#b0b0b0;font-family:var(--font-sans);font-size:14px;font-weight:500}.card-content{font-family:var(--font-mono);font-size:14px;color:#e0e0e0;white-space:pre;padding:20px;max-height:80vh;overflow:auto;line-height:1.6}footer{text-align:center;margin-top:3rem;padding-bottom:1rem;color:var(--text-secondary);font-size:.875rem;transition:color .3s ease}footer a{color:var(--text-primary);text-decoration:none;font-weight:500;transition:color .2s;display:inline-flex;align-items:center;gap:.3rem}footer a:hover{color:var(--primary-color);text-decoration:underline}footer .github-icon{width:1em;height:1em;fill:currentColor}footer p{margin:.5rem 0 0}
        @media (max-width: 768px){body{padding:1rem;justify-content:flex-start}.container{padding:1.5rem;border:none;border-radius:0;box-shadow:none;background-color:var(--bg-color)}h1{font-size:1.5rem}.subtitle{font-size:.9rem;margin-bottom:2rem}.input-wrapper{flex-direction:column}button#generateBtn{padding:1rem}.advanced-options-grid{grid-template-columns:1fr;gap:.5rem}.advanced-options-grid label[for=depthInput]{margin-top:.5rem}#app-controls{top:.75rem;right:.75rem}.result-header{flex-direction:column;align-items:stretch;gap:.75rem}.header-group{justify-content:space-around}.export-tools button span{display:none}.export-tools button{padding:.5rem}footer{margin-top:2rem}}
    </style>
</head>
<body>
    <main class="container">
        <div id="app-controls">
            <button id="lang-toggle" title="Switch Language / 切换语言"></button>
            <button id="theme-toggle" data-i18n-key="themeToggle" data-i18n-attr="title"><svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg><svg id="theme-icon-moon" style="display:none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button>
        </div>
        <h1 data-i18n-key="mainTitle"></h1>
        <p class="subtitle" data-i18n-key="subtitle"></p>
        <div class="input-wrapper">
          <input type="text" id="repoUrl" data-i18n-key="repoUrl" data-i18n-attr="placeholder">
          <button id="generateBtn"><span id="btn-text" data-i18n-key="generate"></span></button>
        </div>
        <details class="advanced-options">
          <summary data-i18n-key="advancedOptions"></summary>
          <div class="advanced-options-grid">
            <label for="excludeInput" data-i18n-key="excludeLabel"></label>
            <label for="depthInput" data-i18n-key="depthLabel"></label>
            <input type="text" id="excludeInput" data-i18n-key="excludeInput" data-i18n-attr="placeholder">
            <input type="number" id="depthInput" min="1" placeholder="∞">
          </div>
        </details>
        <div class="result-wrapper">
          <div class="result-header">
            <div class="header-group view-modes">
              <button id="view-all" class="active" data-i18n-key="viewAll" data-i18n-attr="title"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M10 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h4M14 9h7m-7 6h7M4 9h1m-1 6h1"/></svg> <span>All</span></button>
              <button id="view-folders" data-i18n-key="viewFolders" data-i18n-attr="title"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg> <span>Folders</span></button>
            </div>
            <div class="header-group export-tools">
              <button id="downloadBatBtn" data-i18n-key="downloadBat" data-i18n-attr="title" disabled><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg> <span id="downloadBatText">.bat</span></button>
              <button id="downloadShBtn" data-i18n-key="downloadSh" data-i18n-attr="title" disabled><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg> <span>.sh</span></button>
              <button id="copyMdBtn" data-i18n-key="copyMd" data-i18n-attr="title" disabled><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"/></svg> <span id="copyMdText">Markdown</span></button>
              <button id="exportBtn" data-i18n-key="export" data-i18n-attr="title" disabled><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> <span id="exportText" data-i18n-key="exportBtn"></span></button>
              <button id="copyBtn" data-i18n-key="copy" data-i18n-attr="title" disabled><svg class="copy-icon" id="copy-icon-clipboard" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg><svg class="copy-icon" id="copy-icon-check" style="display:none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg> <span id="copy-text" data-i18n-key="copyBtn"></span></button>
            </div>
          </div>
          <pre id="result" data-i18n-key="resultPlaceholder"></pre>
        </div>
    </main>
    <footer>
       <p>Open-sourced on <a href="https://github.com/Azad-sl/GitTree" target="_blank" rel="noopener noreferrer"><svg class="github-icon" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg> Azad-sl / GitTree</a></p>
    </footer>

    <div id="image-card-container"><div class="macos-window"><div class="title-bar"><div class="traffic-lights"><div class="light red"></div><div class="light yellow"></div><div class="light green"></div></div><div class="title-text"></div></div><pre class="card-content"></pre></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translations = {
                en: {
                    pageTitle: "GitTree - GitHub Repo Tree Generator",mainTitle: "GitHub Repo Tree Generator",subtitle: "Generate, filter, and share a clean directory tree for any public GitHub repo.",repoUrl: "e.g., https://github.com/Azad-sl/GitTree",generate: "Generate",advancedOptions: "Advanced Options",excludeLabel: "Exclude items (comma-separated, `*` supported):",depthLabel: "Max Depth:",excludeInput: "e.g., node_modules, dist, *.log",resultPlaceholder: "Generated tree will be displayed here...",viewAll: "Full View",viewFolders: "Folders Only",downloadBat: "Generate .bat script (Windows)", downloadSh: "Generate .sh script (macOS/Linux)", copyMd: "Copy as Markdown",export: "Export as Image",copy: "Copy to Clipboard",exportBtn: "Export",copyBtn: "Copy",themeToggle: "Toggle light/dark mode",copied: "Copied!",exporting: "Exporting...",errorPrefix: "❌ Error: ",enterURL: "Please enter a GitHub repository URL.",invalidURL: "Invalid GitHub repository URL. Please check the format.",repoNotFound: "Repository or branch not found. Please check the URL.",apiLimit: "API rate limit exceeded. Please wait a moment and try again.",fetchFailed: "Failed to fetch tree data: ",noContent: "No items to display. Please check your filter conditions.",copyFailed: "Copy failed. Your browser might not support it or permission denied.",exportFailed: "Exporting image failed. Check console for details.",noBatContent: "No content to create."
                },
                zh: {
                    pageTitle: "GitTree - GitHub项目目录树生成",mainTitle: "GitHub 项目目录树生成",subtitle: "输入一个公开的 GitHub 仓库链接，优雅地生成、过滤与分享。",repoUrl: "例如: https://github.com/Azad-sl/GitTree",generate: "生成",advancedOptions: "高级选项",excludeLabel: "排除项 (逗号分隔, 支持 `*`):",depthLabel: "最大深度:",excludeInput: "例如: node_modules, dist, *.log",resultPlaceholder: "在这里显示生成的目录树...",viewAll: "完整视图",viewFolders: "仅文件夹",downloadBat: "生成 .bat 脚本 (Windows)", downloadSh: "生成 .sh 脚本 (macOS/Linux)", copyMd: "复制为 Markdown",export: "导出为图片",copy: "复制到剪贴板",exportBtn: "导出",copyBtn: "复制",themeToggle: "切换亮/暗色模式",copied: "已复制!",exporting: "生成中...",errorPrefix: "❌ 错误：",enterURL: "请输入 GitHub 仓库链接。",invalidURL: "无效的 GitHub 仓库链接。请确保格式正确。",repoNotFound: "仓库或分支未找到。请检查链接。",apiLimit: "API访问频率受限，请稍后再试。",fetchFailed: "获取目录树数据失败: ",noContent: "没有可显示的项目，请检查您的过滤条件。",copyFailed: "复制失败，您的浏览器可能不支持或未授予权限。",exportFailed: "导出图片失败，详情请查看控制台。",noBatContent: "没有可创建的内容。"
                }
            };
            let currentLang = 'en';

            const langToggle = document.getElementById('lang-toggle');
            const themeToggle = document.getElementById("theme-toggle");
            const htmlEl = document.documentElement;
            const resultDiv = document.getElementById('result');
            const repoUrlInput = document.getElementById('repoUrl');
            const generateBtn = document.getElementById('generateBtn');
            const excludeInput = document.getElementById('excludeInput');
            const depthInput = document.getElementById('depthInput');
            const copyBtn = document.getElementById('copyBtn');
            const copyMdBtn = document.getElementById('copyMdBtn');
            const exportBtn = document.getElementById('exportBtn');
            const downloadBatBtn = document.getElementById('downloadBatBtn');
            const downloadShBtn = document.getElementById('downloadShBtn'); // NEW: .sh button constant
            const viewAllBtn = document.getElementById('view-all');
            const viewFoldersBtn = document.getElementById('view-folders');
            const btnText = document.getElementById('btn-text');
            const copyText = document.getElementById('copy-text');
            const copyMdText = document.getElementById('copyMdText');
            const exportText = document.getElementById('exportText');
            const iconClipboard = document.getElementById('copy-icon-clipboard');
            const iconCheck = document.getElementById('copy-icon-check');
            const themeIconSun = document.getElementById("theme-icon-sun");
            const themeIconMoon = document.getElementById("theme-icon-moon");

            let fullTreeData = [];
            let currentRepoInfo = null;
            let hasResultForCopy = false;
            let currentViewMode = "all";
            
            function setLanguage(lang) {
                currentLang = lang;
                document.documentElement.lang = lang;
                localStorage.setItem('language', lang);
                langToggle.textContent = lang === 'en' ? '中文' : 'EN';
                document.querySelectorAll('[data-i18n-key]').forEach(el => {
                    const key = el.dataset.i18nKey;
                    const attr = el.dataset.i18nAttr || 'textContent';
                    const translation = translations[lang][key];
                    if (translation !== undefined) { el[attr] = translation; }
                });
                document.title = translations[lang].pageTitle;
            }

            function applyTheme(theme) {
                htmlEl.setAttribute("data-theme", theme);
                themeIconSun.style.display = theme === 'dark' ? "none" : "block";
                themeIconMoon.style.display = theme === 'dark' ? "block" : "none";
            }
            
            function toggleTheme() {
                const newTheme = htmlEl.getAttribute("data-theme") === "dark" ? "light" : "dark";
                applyTheme(newTheme);
                localStorage.setItem("theme", newTheme);
            }

            function setShareButtonsState(enabled) {
                hasResultForCopy = enabled;
                [copyBtn, exportBtn, copyMdBtn, downloadBatBtn, downloadShBtn].forEach(btn => btn.disabled = !enabled);
            }

            function generateShContent() {
                if (!currentRepoInfo || fullTreeData.length === 0) return '';
                const rootDir = currentRepoInfo.repo;
                const filteredItems = filterTree(fullTreeData, excludeInput.value.split(',').map(p => p.trim()).filter(Boolean), parseInt(depthInput.value, 10) || Infinity, currentViewMode);
                
                const commands = [
                    '#!/bin/bash',
                    '# Generated by GitTree',
                    '',
                    `echo "Creating directory structure for '${rootDir}'..."`,
                    `mkdir -p "${rootDir}"`,
                    `cd "${rootDir}"`,
                    ''
                ];

                const dirsToCreate = new Set();
                const filesToCreate = new Set();

                for (const item of filteredItems) {
                    if (item.type === 'tree') {
                        dirsToCreate.add(item.path);
                    } else if (item.type === 'blob') {
                        const lastSlash = item.path.lastIndexOf('/');
                        if (lastSlash > -1) {
                           dirsToCreate.add(item.path.substring(0, lastSlash));
                        }
                        filesToCreate.add(item.path);
                    }
                }
                
                if (dirsToCreate.size > 0) {
                    commands.push('# Creating directories...');
                    dirsToCreate.forEach(dir => commands.push(`mkdir -p "${dir}"`));
                    commands.push('');
                }

                if (filesToCreate.size > 0) {
                    commands.push('# Creating files...');
                    filesToCreate.forEach(file => commands.push(`touch "${file}"`));
                    commands.push('');
                }

                commands.push(`echo "Directory structure for '${rootDir}' created successfully!"`);
                return commands.join('\n'); // Use LF line endings for shell scripts
            }
            
            function generateBatContent() {
                if (!currentRepoInfo || fullTreeData.length === 0) return '';
                const rootDir = currentRepoInfo.repo;
                const filteredItems = filterTree(fullTreeData, excludeInput.value.split(',').map(p => p.trim()).filter(Boolean), parseInt(depthInput.value, 10) || Infinity, currentViewMode);
                const commands = ['@echo off', 'chcp 65001 > nul', `echo Creating directory structure for ${rootDir}...`, `if not exist "${rootDir}" ( md "${rootDir}" )`, `cd "${rootDir}"`, ''];
                filteredItems.sort((a,b) => a.path.localeCompare(b.path));
                for (const item of filteredItems) {
                    const windowsPath = item.path.replace(/\//g, '\\');
                    if (item.type === 'tree') {
                        commands.push(`if not exist "${windowsPath}" ( md "${windowsPath}" )`);
                    } else if (item.type === 'blob') {
                        const lastBackslash = windowsPath.lastIndexOf('\\');
                        if (lastBackslash > -1) {
                            const dir = windowsPath.substring(0, lastBackslash);
                            commands.push(`if not exist "${dir}" ( md "${dir}" )`);
                        }
                        commands.push(`if not exist "${windowsPath}" ( type NUL > "${windowsPath}" )`);
                    }
                }
                commands.push('', 'echo.', `echo Directory structure for "${rootDir}" created successfully!`, 'pause');
                return commands.join('\r\n'); 
            }


            function parseGitHubUrl(url) {const match = /https?:\/\/github\.com\/([^\/]+)\/([^\/\s]+)/.exec(url); return match ? { owner: match[1], repo: match[2].replace(".git", ""), branch: "main" } : null;}
            function showError(messageKey) {let message = translations[currentLang][messageKey] || messageKey; if (messageKey.startsWith('fetchFailed')) {message = translations[currentLang].fetchFailed + messageKey.replace('fetchFailed', '');} resultDiv.textContent = translations[currentLang].errorPrefix + message; resultDiv.className = "error";}
            function showSuccess(text) {resultDiv.textContent = text; resultDiv.className = "";}
            function setLoading(isLoading) {generateBtn.disabled = isLoading; if (isLoading) {btnText.textContent = ""; const spinner = document.createElement("span"); spinner.className = "spinner"; generateBtn.prepend(spinner);} else {btnText.textContent = translations[currentLang].generate; const spinner = generateBtn.querySelector(".spinner"); if (spinner) spinner.remove();}}
            async function fetchTreeData(owner, repo, branch) { let response = await fetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`); if (response.status === 404) { console.log("Branch 'main' not found, trying 'master'"); response = await fetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/master?recursive=1`); } if (!response.ok) { if (response.status === 404) throw new Error('repoNotFound'); if (response.status === 403) throw new Error('apiLimit'); throw new Error('fetchFailed' + response.statusText); } const data = await response.json(); if (data.truncated) { alert("Warning: The file list is too large and has been truncated by the GitHub API. The generated tree may be incomplete."); } return data.tree; }
            function filterTree(tree, excludePatterns, maxDepth, viewMode) { return tree.filter(item => { const depth = item.path.split('/').length; if (depth > maxDepth) return false; const isExcluded = excludePatterns.some(pattern => { if (pattern.startsWith('*.')) { return item.path.endsWith(pattern.substring(1)); } return item.path.split('/').includes(pattern); }); if (isExcluded) return false; if (viewMode === 'folders' && item.type !== 'tree') return false; return true; }); }
            function buildTreeString(repoName, tree, maxDepth) { if (!tree || tree.length === 0) return translations[currentLang].noContent; const root = {}; tree.forEach(item => { let path = item.path.split('/'); let currentLevel = root; for (let i = 0; i < path.length; i++) { let part = path[i]; if (!currentLevel[part]) { currentLevel[part] = (i === path.length - 1 && item.type === 'blob') ? null : {}; } currentLevel = currentLevel[part]; } }); let treeString = `${repoName}/\n`; const build = (node, prefix = "", level = 1) => { const entries = Object.keys(node).sort((a, b) => { const aIsDir = node[a] !== null; const bIsDir = node[b] !== null; if (aIsDir !== bIsDir) return aIsDir ? -1 : 1; return a.localeCompare(b); }); entries.forEach((entry, index) => { const isLast = index === entries.length - 1; const connector = isLast ? "└── " : "├── "; treeString += `${prefix}${connector}${entry}\n`; const child = node[entry]; if (child !== null && level < maxDepth) { const newPrefix = prefix + (isLast ? "    " : "│   "); build(child, newPrefix, level + 1); } }); }; build(root); return treeString.trim(); }
            function renderTree() { if (!currentRepoInfo) return; const excludePatterns = excludeInput.value.split(',').map(p => p.trim()).filter(Boolean); const maxDepth = parseInt(depthInput.value, 10) || Infinity; const filteredTree = filterTree(fullTreeData, excludePatterns, maxDepth, currentViewMode); const treeString = buildTreeString(currentRepoInfo.repo, filteredTree, maxDepth); showSuccess(treeString); if (filteredTree.length > 0) { setShareButtonsState(true); } else { setShareButtonsState(false); } }
            function setViewMode(mode) { if (currentViewMode === mode) return; currentViewMode = mode; viewAllBtn.classList.toggle("active", mode === "all"); viewFoldersBtn.classList.toggle("active", mode === "folders"); if (hasResultForCopy) { renderTree(); } }
            async function handleGenerationWrapper() { setShareButtonsState(false); const url = repoUrlInput.value.trim(); if (!url) { showError('enterURL'); return; } currentRepoInfo = parseGitHubUrl(url); if (!currentRepoInfo) { showError('invalidURL'); return; } setLoading(true); try { const rawTree = await fetchTreeData(currentRepoInfo.owner, currentRepoInfo.repo, currentRepoInfo.branch); fullTreeData = rawTree; renderTree(); } catch (error) { showError(error.message); fullTreeData = []; currentRepoInfo = null; } finally { setLoading(false); } }

            generateBtn.addEventListener("click", handleGenerationWrapper);
            repoUrlInput.addEventListener("keydown", e => { if (e.key === "Enter") handleGenerationWrapper(); });
            viewAllBtn.addEventListener("click", () => setViewMode("all"));
            viewFoldersBtn.addEventListener("click", () => setViewMode("folders"));
            langToggle.addEventListener('click', () => { const newLang = currentLang === 'en' ? 'zh' : 'en'; setLanguage(newLang); });
            themeToggle.addEventListener("click", toggleTheme);

            copyBtn.addEventListener("click", ()=>{if(!hasResultForCopy)return;navigator.clipboard.writeText(resultDiv.innerText).then(()=>{copyText.textContent=translations[currentLang].copied,iconClipboard.style.display="none",iconCheck.style.display="inline-block",setTimeout(()=>{copyText.textContent=translations[currentLang].copyBtn,iconClipboard.style.display="inline-block",iconCheck.style.display="none"},2e3)}).catch(e=>{console.error("Copy failed:",e),alert(translations[currentLang].copyFailed)})});
            copyMdBtn.addEventListener('click',()=>{if(!hasResultForCopy)return;const e="```\n"+resultDiv.innerText+"\n```";navigator.clipboard.writeText(e).then(()=>{const e=copyMdText.textContent;copyMdText.textContent=translations[currentLang].copied,setTimeout(()=>{copyMdText.textContent=e},2e3)}).catch(e=>{console.error("Copy Markdown failed:",e),alert(translations[currentLang].copyFailed)})});
            exportBtn.addEventListener('click',async()=>{if(!hasResultForCopy)return;exportText.textContent=translations[currentLang].exporting,exportBtn.disabled=!0;const e=document.getElementById("image-card-container"),t=e.querySelector(".title-text"),o=e.querySelector(".card-content");try{o.style.maxHeight="none",t.textContent=`${currentRepoInfo.owner}/${currentRepoInfo.repo}`,o.textContent=resultDiv.textContent;const n=await html2canvas(e,{useCORS:!0,backgroundColor:null}),r=document.createElement("a");r.download=`${currentRepoInfo.repo}-tree.png`,r.href=n.toDataURL("image/png"),r.click()}catch(n){console.error("Exporting image failed:",n),alert(translations[currentLang].exportFailed)}finally{o.style.maxHeight="",exportText.textContent=translations[currentLang].exportBtn,exportBtn.disabled=!1}});
            
            downloadBatBtn.addEventListener('click', () => {
                if (!hasResultForCopy || !currentRepoInfo) return;
                const content = generateBatContent();
                if (!content) { alert(translations[currentLang].noBatContent); return; }
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `create_${currentRepoInfo.repo}_structure.bat`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            });

            downloadShBtn.addEventListener('click', () => {
                if (!hasResultForCopy || !currentRepoInfo) return;
                const content = generateShContent();
                if (!content) { alert(translations[currentLang].noBatContent); return; }
                const blob = new Blob([content], { type: 'application/x-shellscript' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `create_${currentRepoInfo.repo}_structure.sh`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            });


            const savedLang = localStorage.getItem('language');
            const browserLang = navigator.language.startsWith('zh') ? 'zh' : 'en';
            setLanguage(savedLang || browserLang);
            applyTheme(localStorage.getItem("theme") || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
        });
    </script>
</body>
</html>
